{% extends "laporan_base.html" %}
{% block title %}Laporan Total Layanan Pembayaran{% endblock title %}

{% block content %}
<div class="container table-container">
    <h2 class="text-center">Laporan Total Layanan Pembayaran</h2>
    <div class="d-flex justify-content-center align-items-center mb-3">
        <p class="mb-0 mr-3"><strong>Periode Transaksi : </strong>{% if dari_tanggal %}{{dari_tanggal|date:"d/m/Y"}}{% else %}Semua Waktu{% endif %} <strong>sd</strong> {% if sampai_tanggal %}{{sampai_tanggal|date:"d/m/Y"}}{% else %}Semua Waktu{% endif %}</p>
        <p class="mb-0 mr-3"><strong>Layanan Pembayaran : </strong>{% if layanan_pembayaran %}{{ layanan_pembayaran }}{% else %}Semua Layanan Pembayaran{% endif %}</p>
    </div>
    <table>
        <thead>
            <tr>
                <th>No</th>
                <th>Layanan Pembayaran</th>
                <th>Jumlah</th>
                <th>Total Harga</th>
            </tr>
        </thead>
        <tbody>
            {% for item in payment_method_counts %}
                {% if item.layanan_pembayaran == 'total' %}
                    <tr >
                        <td colspan="2"><strong>{{ item.layanan_pembayaran|capfirst }}</strong></td>
                        <td><strong>{{ item.jumlah }}</strong></td>
                        <td><strong>Rp. {{ item.total_harga|floatformat:0|default:"0" }}</strong></td>
                    </tr>
                {% else %}
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td>{{ item.layanan_pembayaran }}</td>
                        <td>{{ item.jumlah }}</td>
                        <td>Rp. {{ item.total_harga|floatformat:0|default:"0" }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}
{% comment %} {% extends "laporan_base.html" %}
{% block title %}Laporan Total Layanan Pembayaran{% endblock title %}

{% block content %}
<div class="container table-container">
    <h2 class="text-center">Laporan Total Layanan Pembayaran</h2>
    <div class="d-flex justify-content-center align-items-center mb-3">
        <div class="d-flex justify-content-center align-items-center mb-3">
            <p class="mb-0 mr-3"><strong>Periode Transaksi : </strong>{% if dari_tanggal %}{{dari_tanggal|date:"d/m/Y"}}{% else %}Semua Waktu{% endif %} <strong>sd</strong> {% if sampai_tanggal %}{{sampai_tanggal|date:"d/m/Y"}}{% else %}Semua Waktu{% endif %}</p>
            <p class="mb-0 mr-3"><strong>Layanan Pembayaran : </strong>{% if layanan_pembayaran %}{{ layanan_pembayaran }}{% else %}Semua Layanan Pembayaran{% endif %}</p>
            
        </div>
    </div>

    <table class="table-bordered" style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background-color: #f0f0f0; color: #000;">
                <th style="padding: 8px; border: 1px solid #000;">No</th>
                <th style="padding: 8px; border: 1px solid #000;">Bank</th>
                <th style="padding: 8px; border: 1px solid #000;">Nama</th>
                <th style="padding: 8px; border: 1px solid #000;">Tanggal</th>
                <th style="padding: 8px; border: 1px solid #000;">Jumlah</th>
                <th style="padding: 8px; border: 1px solid #000;">Harga</th>
                <th style="padding: 8px; border: 1px solid #000;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for layanan, data in payment_data.items %}
                {% if layanan != 'total' %}
                    <!-- Display bank name, jumlah, and total only on the first row for each bank, using rowspan -->
                    {% for trans in data.transactions %}
                        <tr>
                            {% if forloop.first %}
                            <td rowspan="{{ data.rowspan }}" style="padding: 8px; border: 1px solid #000; text-align: center;">{{ forloop.parentloop.counter }}</td>

                                <td rowspan="{{ data.rowspan }}" style="padding: 8px; border: 1px solid #000;">{{ layanan }}</td>
                                <td style="padding: 8px; border: 1px solid #000;">{{ trans.user.full_name }}</td>
                                <td style="padding: 8px; border: 1px solid #000;">{{ trans.tanggal|date:"d/m/Y" }}</td>
                                <td rowspan="{{ data.rowspan }}" style="padding: 8px; border: 1px solid #000;">{{ data.jumlah }}</td>
                                <td style="padding: 8px; border: 1px solid #000;">Rp. {{ trans.harga|floatformat:0|default:"0" }}</td>
                                <td rowspan="{{ data.rowspan }}" style="padding: 8px; border: 1px solid #000;">Rp. {{ data.total_harga|floatformat:0|default:"0" }}</td>
                            {% else %}
                                <td style="padding: 8px; border: 1px solid #000;">{{ trans.user.full_name }}</td>
                                <td style="padding: 8px; border: 1px solid #000;">{{ trans.tanggal|date:"d/m/Y" }}</td>
                                <td style="padding: 8px; border: 1px solid #000;">Rp. {{ trans.harga|floatformat:0|default:"0" }}</td>
                            {% endif %}
                        </tr>
                    {% endfor %}
                {% endif %}
            {% endfor %}

            <!-- Total Summary Row -->
            <tr>
                <td colspan="4" style="padding: 8px; border: 1px solid #000; font-weight: bold;">Total</td>
                <td style="padding: 8px; border: 1px solid #000; font-weight: bold;">{{ payment_data.total.jumlah }}</td>
                <td style="padding: 8px; border: 1px solid #000;"></td>
                <td style="padding: 8px; border: 1px solid #000; font-weight: bold;">Rp. {{ payment_data.total.total_harga|floatformat:0|default:"0" }}</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock content %} {% endcomment %}
